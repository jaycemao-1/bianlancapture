# 区域截图编辑一体化设计

## 目标
- 在编辑器内同时支持裁剪框调整与标注编辑（画笔/箭头/文本等），不分两步
- 编辑器 UI 风格接近参考图：底部浮动工具条、裁剪框高亮、控制点清晰
- 解决窗口缩放时工具条文字被遮挡的问题

## 现状简述
- 编辑器目前只有顶部工具栏与画布，缺少裁剪框与遮罩层
- 保存/钉图直接输出完整渲染图，没有裁剪步骤

## 架构与组件
- 编辑器画布分层：原图层、标注层、裁剪交互层
- 裁剪交互层负责：绘制遮罩、裁剪框边界、控制点、尺寸标签、拖拽调整
- 裁剪状态存放在 EditorState，坐标以原图尺寸为基准

## 交互规则
- 裁剪框常驻显示，支持四角/四边控制点拖拽调整
- 绘制操作优先：拖拽选区内部直接绘制，只有命中控制点时才调整裁剪
- 裁剪框最小尺寸与边界限制，避免无效裁剪

## 数据流与渲染
- 标注坐标继续以原图坐标存储，不随裁剪变化而改变
- 画面预览：裁剪框外添加半透明遮罩，内部保持清晰
- 导出流程：先渲染原图+标注，再按裁剪矩形裁剪输出

## UI 设计要点
- 底部浮动工具条（胶囊背景、半透明材质、投影）
- 工具条自适应：宽度不足时切换紧凑布局（图标优先）
- 裁剪框颜色与控制点风格贴近参考图，保证识别度

## 边界与异常处理
- 裁剪矩形始终限制在图像范围内
- 最小裁剪尺寸约束（例如 20×20）
- 窗口变窄时工具条切换为紧凑模式，避免文字被遮挡

## 测试与验收
- 单元测试：裁剪矩形坐标映射、裁剪输出尺寸正确
- 手动验收：
  - 裁剪 + 标注同时可用
  - 裁剪后保存结果与预览一致
  - 工具条在窄窗口不遮挡文字

## 风险与说明
- 当前目录非 git 仓库，无法按流程提交设计文档；如需可初始化 git 后补交
